var T=s=>{throw TypeError(s)};var j=(s,t,e)=>t.has(s)||T("Cannot "+e);var i=(s,t,e)=>(j(s,t,"read from private field"),e?e.call(s):t.get(s)),O=(s,t,e)=>t.has(s)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),x=(s,t,e,r)=>(j(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e),S=(s,t,e)=>(j(s,t,"access private method"),e);import{d as it,a as q,t as L,c as at}from"../chunks/disclose-version.CadwTKgb.js";import"../chunks/legacy.DbdqsDTS.js";import{p as ot,s as y,f as z,a as nt,c as $,r as w,t as G,j as K}from"../chunks/runtime.894U78pH.js";import{s as E}from"../chunks/render.xGvF74QX.js";import{i as B}from"../chunks/if.c-k1-6Nt.js";import{e as ut,i as ht}from"../chunks/each.DR_aY-aq.js";import{i as ct}from"../chunks/lifecycle.CXqBtWHR.js";import{s as pt,a as H}from"../chunks/store.qlBs9oX5.js";import{h as mt}from"../chunks/http-client.DKCzLOV8.js";import{u as W,i as dt,n as lt,c as vt}from"../chunks/createQuery.DZbzoLsJ.js";import{r as J,g as ft,d as bt}from"../chunks/index.VBw9ufHl.js";import{g as _t}from"../chunks/mutation.CXoJFZIq.js";import{S as yt,s as gt,h as N,n as X}from"../chunks/context.0PKaMQDM.js";var f,b,a,d,l,D,A,V,Mt=(V=class extends yt{constructor(t,e){super();O(this,l);O(this,f);O(this,b);O(this,a);O(this,d);x(this,f,t),this.setOptions(e),this.bindMethods(),S(this,l,D).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const e=this.options;this.options=i(this,f).defaultMutationOptions(t),gt(this.options,e)||i(this,f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,a),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&N(e.mutationKey)!==N(this.options.mutationKey)?this.reset():((r=i(this,a))==null?void 0:r.state.status)==="pending"&&i(this,a).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,a))==null||t.removeObserver(this)}onMutationUpdate(t){S(this,l,D).call(this),S(this,l,A).call(this,t)}getCurrentResult(){return i(this,b)}reset(){var t;(t=i(this,a))==null||t.removeObserver(this),x(this,a,void 0),S(this,l,D).call(this),S(this,l,A).call(this)}mutate(t,e){var r;return x(this,d,e),(r=i(this,a))==null||r.removeObserver(this),x(this,a,i(this,f).getMutationCache().build(i(this,f),this.options)),i(this,a).addObserver(this),i(this,a).execute(t)}},f=new WeakMap,b=new WeakMap,a=new WeakMap,d=new WeakMap,l=new WeakSet,D=function(){var e;const t=((e=i(this,a))==null?void 0:e.state)??_t();x(this,b,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},A=function(t){X.batch(()=>{var e,r,c,p,g,M,h,m;if(i(this,d)&&this.hasListeners()){const n=i(this,b).variables,_=i(this,b).context;(t==null?void 0:t.type)==="success"?((r=(e=i(this,d)).onSuccess)==null||r.call(e,t.data,n,_),(p=(c=i(this,d)).onSettled)==null||p.call(c,t.data,null,n,_)):(t==null?void 0:t.type)==="error"&&((M=(g=i(this,d)).onError)==null||M.call(g,t.error,n,_),(m=(h=i(this,d)).onSettled)==null||m.call(h,void 0,t.error,n,_))}this.listeners.forEach(n=>{n(i(this,b))})})},V);function Ot(s,t){const e=W(),r=dt(s)?s:J(s),c=new Mt(e,ft(r));let p;r.subscribe(h=>{p=(m,n)=>{c.mutate(m,n).catch(lt)},c.setOptions(h)});const g=J(c.getCurrentResult(),h=>c.subscribe(X.batchCalls(m=>h(m)))),{subscribe:M}=bt(g,h=>({...h,mutate:p,mutateAsync:h.mutate}));return{subscribe:M}}const xt=async()=>(await mt.get("/movies")).data;var St=L("<p> </p>"),$t=L("<p>Loading...</p>"),wt=(s,t,e,r)=>{t().mutate(K(r)._id)},Ct=L("<div><h2> </h2> <p> </p> <p> </p> <p> </p> <button>delete</button></div>"),qt=L("<h1>Liste Planets</h1> <!> <!> <!>",1);function Tt(s,t){ot(t,!1);const e=pt(),r=()=>H(g,"$query",e),c=()=>H(m,"$mutation",e),p=W(),g=vt({queryKey:["movies"],queryFn:xt}),M=u=>new Promise(o=>setTimeout(o,u)),m=Ot({mutationFn:async u=>{throw await M(2e3),new Error("Error")},onMutate:async u=>{const o=p.getQueryData(["movies"]);return p.setQueryData(["movies"],v=>v.filter(Q=>Q._id!==u)),{movies:o}},onError:(u,o,v)=>{v&&p.setQueryData(["movies"],v.movies)},onSuccess:()=>{r().refetch()}});ct();var n=qt(),_=y(z(n),2);B(_,()=>r().error,u=>{var o=St(),v=$(o,!0);w(o),G(()=>E(v,r().error)),q(u,o)});var I=y(_,2);B(I,()=>r().isLoading,u=>{var o=$t();q(u,o)});var Y=y(I,2);B(Y,()=>r().data,u=>{var o=at(),v=z(o);ut(v,1,()=>r().data,ht,(Q,C)=>{var R=Ct(),k=$(R),Z=$(k,!0);w(k);var P=y(k,2),tt=$(P);w(P);var F=y(P,2),et=$(F);w(F);var U=y(F,2),st=$(U);w(U);var rt=y(U,2);rt.__click=[wt,c,m,C],w(R),G(()=>{E(Z,K(C).title),E(tt,`Director: ${K(C).director??""}`),E(et,`Producer: ${K(C).producer??""}`),E(st,`Release date: ${K(C).release_date??""}`)}),q(Q,R)}),q(u,o)}),q(s,n),nt()}it(["click"]);export{Tt as component};
